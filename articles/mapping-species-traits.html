<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mapping species traits: community level analysis • letsR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mapping species traits: community level analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">letsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A-guide-to-transform-species-distributions-into-a-presence-absence-matrix-based.html">A guide to transform species distributions into a presence absence matrix based on a user-defined grid in R</a></li>
    <li><a class="dropdown-item" href="../articles/Adding-variables-to-a-presenceabsence-object.html">Adding variables to a PresenceAbsence object</a></li>
    <li><a class="dropdown-item" href="../articles/cropping-and-subseting-your-presence-absence-matrix.html">Cropping and subseting your presence absence matrix</a></li>
    <li><a class="dropdown-item" href="../articles/mapping-species-traits.html">Mapping species traits: community level analysis</a></li>
    <li><a class="dropdown-item" href="../articles/save-load-presenceabsence.html">How to save and load a PresenceAbsence object</a></li>
    <li><a class="dropdown-item" href="../articles/species-level-macroecological-analysis.html">Macroecological analysis at the species level</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/macroecology/letsR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mapping species traits: community level analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/macroecology/letsR/blob/master/vignettes/mapping-species-traits.Rmd" class="external-link"><code>vignettes/mapping-species-traits.Rmd</code></a></small>
      <div class="d-none name"><code>mapping-species-traits.Rmd</code></div>
    </div>

    
    
<p>Many times scientists are interested in analyzing or describing the
geographical variation of a trait. For example, how species body size
varies across the space. Here I will show how to map species traits
using the <code>letsR</code> package.</p>
<p>To do this, let’s test the Rapoport’s rule on Phyllomedusa frogs.
“Rapoport’s rule is an ecogeographical rule that states that latitudinal
ranges of plants and animals are generally smaller at lower latitudes
than at higher latitudes”.</p>
<p>To start this test we can load our <code>PresenceAbsence</code>
example object for the Phyllomedusa species.</p>
<p><em>Note: I recommend to use the latest version of the
<code>letsR</code> package on <a href="https://github.com/macroecology/letsR" class="external-link">GitHub</a></em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.12401" class="external-link">letsR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"PAM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">PAM</span><span class="op">)</span></span></code></pre></div>
<p><img src="mapping-species-traits_files/figure-html/r-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Now, we have to calculate the species range sizes. <code>letsR</code>
includes a function to do that called <code>lets.rangesize</code>. We
can calculate the range size from the <code>PresenceAbsence</code>
matrix, as the number of cells or in square meters. Alternatively, we
can do it directly on the species ranges shapefiles. Let’s do the latter
option, since it is more accurate, although all options should be
correlated.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Phyllomedusa"</span><span class="op">)</span></span>
<span><span class="va">rangesize</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.rangesize.html">lets.rangesize</a></span><span class="op">(</span><span class="va">Phyllomedusa</span>,</span>
<span>                            coordinates <span class="op">=</span> <span class="st">"geographic"</span><span class="op">)</span></span>
<span><span class="va">rangesize</span> <span class="op">&lt;-</span> <span class="va">rangesize</span> <span class="op">/</span> <span class="fl">1000</span> <span class="co"># Transform in km2</span></span></code></pre></div>
<div class="section level2">
<h2 id="community-level-analysis">Community level analysis<a class="anchor" aria-label="anchor" href="#community-level-analysis"></a>
</h2>
<p>To map this trait by cell, we can use the <code>lets.maplizer</code>
function. You can choose the function to aggregate the species trait per
cell, but in this case we want to use the default option that will
average the values. We also want the function to return a raster with
the mapped traits, so we will set <code>ras = TRUE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.maplizer.html">lets.maplizer</a></span><span class="op">(</span><span class="va">PAM</span>, <span class="va">rangesize</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">rangesize</span><span class="op">)</span>, ras <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">cols2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#e0ecf4'</span>,<span class="st">'#9ebcda'</span>,<span class="st">'#8856a7'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resu</span><span class="op">$</span><span class="va">Raster</span>, col <span class="op">=</span> <span class="fu">cols2</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Mean Range Size"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"wrld_simpl"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">wrld_simpl</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="mapping-species-traits_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Visually, the Rapoport’s rule doesn’t seem to work on Phyllomedusa
frogs. We can go further and see the relationship with latitude.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">resu</span><span class="op">$</span><span class="va">Matrix</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">`Latitude(y)`</span>, <span class="va">Variable_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">lm</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">.6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Range Size"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="mapping-species-traits_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Seems that the Rapoport’s rule doesn’t stand for this genus, actually
the direction seems inverted, at least when analyzing it at the
community level. However, to confirm this we would have to perform
formal statistical analysis and control for spatial autocorrelation
problems.</p>
<p><em>A quick note here. Scientists should be careful with this type of
community analysis, as the repetition in species co-occurrence can
easily generate spurious patterns and significant correlations (<a href="https://onlinelibrary.wiley.com/doi/full/10.1111/jbi.12953" class="external-link">see
our paper for further discussion</a>).</em></p>
<p><strong>To cite letsR in publications use:</strong> <em>Bruno Vilela
and Fabricio Villalobos (2015). letsR: a new R package for data handling
and analysis in macroecology. Methods in Ecology and Evolution. DOI:
10.1111/2041-210X.12401</em></p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bruno Vilela, Fabricio Villalobos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
