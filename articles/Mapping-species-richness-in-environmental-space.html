<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mapping species richness in environmental space • letsR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mapping species richness in environmental space">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">letsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A-guide-to-transform-species-distributions-into-a-presence-absence-matrix-based.html">A guide to transform species distributions into a presence absence matrix based on a user-defined grid in R</a></li>
    <li><a class="dropdown-item" href="../articles/Adding-variables-to-a-presenceabsence-object.html">Adding variables to a PresenceAbsence object</a></li>
    <li><a class="dropdown-item" href="../articles/cropping-and-subseting-your-presence-absence-matrix.html">Cropping and subseting your presence absence matrix</a></li>
    <li><a class="dropdown-item" href="../articles/Cross-mapping-biodiversity-metrics-Phyllomedusa.html">Cross-mapping biodiversity metrics across spaces</a></li>
    <li><a class="dropdown-item" href="../articles/Mapping-species-richness-in-attribute-space.html">Mapping species richness in attribute space</a></li>
    <li><a class="dropdown-item" href="../articles/Mapping-species-richness-in-environmental-space.html">Mapping species richness in environmental space</a></li>
    <li><a class="dropdown-item" href="../articles/mapping-species-traits.html">Mapping species traits: community level analysis</a></li>
    <li><a class="dropdown-item" href="../articles/save-load-presenceabsence.html">How to save and load a PresenceAbsence object</a></li>
    <li><a class="dropdown-item" href="../articles/species-level-macroecological-analysis.html">Macroecological analysis at the species level</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/macroecology/letsR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mapping species richness in environmental space</h1>
                        <h4 data-toc-skip class="author">Bruno
Vilela</h4>
            
            <h4 data-toc-skip class="date">2025-07-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/macroecology/letsR/blob/master/vignettes/Mapping-species-richness-in-environmental-space.Rmd" class="external-link"><code>vignettes/Mapping-species-richness-in-environmental-space.Rmd</code></a></small>
      <div class="d-none name"><code>Mapping-species-richness-in-environmental-space.Rmd</code></div>
    </div>

    
    
<p>Species richness and distributions are often analyzed in geographic
space. However, understanding biodiversity in environmental space (e.g.,
across gradients of temperature and precipitation) is fundamental to
further understand ecological communities and species distribution.</p>
<p>The new function <code><a href="../reference/lets.envpam.html">lets.envpam()</a></code> from the
<code>letsR</code> package allows users to transform a geographic
presence–absence matrix (PAM) into an environmental-space PAM, by
binning species occurrences according to environmental variables.</p>
<div class="section level3">
<h3 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h3>
<p>To start this test we can load our example datasets of
<code>Phyllomedusa</code> frog species occurrences and two environmental
layers: temperature and precipitation.</p>
<p><em>Note: I recommend to use the latest version of the
<code>letsR</code> package on <a href="https://github.com/macroecology/letsR" class="external-link">GitHub</a></em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.12401" class="external-link">letsR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load species occurrences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Phyllomedusa"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and unwrap environmental rasters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"prec"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"temp"</span><span class="op">)</span></span>
<span><span class="va">prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p>Notice that we need to generate a PAM without removing the cells
without records. We can also remove data beyond the geographic limits of
continents as the example species are continental organisms.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a geographic PAM</span></span>
<span><span class="va">pam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.presab.html">lets.presab</a></span><span class="op">(</span><span class="va">Phyllomedusa</span>, remove.cells <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Crop the PAM to the world's landmasses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"wrld_simpl"</span>, package <span class="op">=</span> <span class="st">"letsR"</span><span class="op">)</span></span>
<span><span class="va">pam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.PAMcrop.html">lets.pamcrop</a></span><span class="op">(</span><span class="va">pam</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">wrld_simpl</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we need to add our environmental data to the pam using the
<code>lets.addvar</code> function. Note that we only need to keep the
variables, so set the <code>onlyvar</code> argument
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract environmental values</span></span>
<span><span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.addvar.html">lets.addvar</a></span><span class="op">(</span><span class="va">pam</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">prec</span><span class="op">)</span>, onlyvar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Temperature"</span>, <span class="st">"Precipitation"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-a-pam-in-environmental-space">Creating a PAM in environmental space<a class="anchor" aria-label="anchor" href="#creating-a-pam-in-environmental-space"></a>
</h3>
<p>We can now combine the <code>PresenceAbsence</code> object and the
<code>envs</code> object to create the presence absence matrix in the
environmental space using the <code>lets.envpam</code>function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform PAM into environmental space</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.envpam.html">lets.envpam</a></span><span class="op">(</span><span class="va">pam</span>, <span class="va">envs</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object <code>res</code> contains:</p>
<ul>
<li>
<code>Presence_and_Absence_Matrix_env</code>: a matrix of species
presence across environmental cells.<br>
</li>
<li>
<code>Presence_and_Absence_Matrix_geo</code>: the original PAM
coordinates associated with environmental cells.<br>
</li>
<li>
<code>Env_Richness_Raster</code>: raster showing richness in binned
environmental space.<br>
</li>
<li>
<code>Geo_Richness_Raster</code>: the original richness raster in
geographic space.</li>
</ul>
<p>You will note that the environmental and geographic presence–absence
matrices share a common identifier: the <code>Cell_env</code> column.
This linkage allows users to perform integrated analyses, facilitating
the transfer of information between environmental and geographic spaces
in both directions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span><span class="op">$</span><span class="va">Presence_and_Absence_Matrix_env</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;     Cell_env Temperature Precipitation Phyllomedusa araguari</span></span>
<span><span class="co">#&gt; 269      269    26.46848      4568.828                     0</span></span>
<span><span class="co">#&gt; 387      387    24.65896      3719.128                     0</span></span>
<span><span class="co">#&gt; 389      389    26.46848      3719.128                     0</span></span>
<span><span class="co">#&gt; 417      417    24.65896      3506.702                     0</span></span>
<span><span class="co">#&gt; 418      418    25.56372      3506.702                     0</span></span>
<span><span class="co">#&gt;     Phyllomedusa atelopoides</span></span>
<span><span class="co">#&gt; 269                        0</span></span>
<span><span class="co">#&gt; 387                        0</span></span>
<span><span class="co">#&gt; 389                        0</span></span>
<span><span class="co">#&gt; 417                        0</span></span>
<span><span class="co">#&gt; 418                        0</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span><span class="op">$</span><span class="va">Presence_and_Absence_Matrix_geo</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;      Cell_env Cell_geo Longitude(x) Latitude(y) Phyllomedusa araguari</span></span>
<span><span class="co">#&gt; [1,]      750        3    -75.92399     10.5907                     0</span></span>
<span><span class="co">#&gt; [2,]      750        4    -74.92399     10.5907                     0</span></span>
<span><span class="co">#&gt; [3,]      715        5    -73.92399     10.5907                     0</span></span>
<span><span class="co">#&gt; [4,]      716        6    -72.92399     10.5907                     0</span></span>
<span><span class="co">#&gt; [5,]      780        7    -71.92399     10.5907                     0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-environmental-richness">Visualizing environmental richness<a class="anchor" aria-label="anchor" href="#visualizing-environmental-richness"></a>
</h3>
<p>The <code>letsR</code> package also offers a function to plot
richness plot in both environmental and geographic space.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lets.plot.envpam.html">lets.plot.envpam</a></span><span class="op">(</span><span class="va">res</span>,</span>
<span>            world <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Mapping-species-richness-in-environmental-space_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="768" style="display: block; margin: auto;"></p>
<p>This plot shows species richness both in geographic (left) and
environmental (right) space.</p>
</div>
<div class="section level3">
<h3 id="highlighting-a-single-species">Highlighting a single species<a class="anchor" aria-label="anchor" href="#highlighting-a-single-species"></a>
</h3>
<p>To visualize where a specific species occurs in both spaces:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lets.plot.envpam.html">lets.plot.envpam</a></span><span class="op">(</span><span class="va">res</span>, species <span class="op">=</span> <span class="st">"Phyllomedusa atelopoides"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Mapping-species-richness-in-environmental-space_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="mapping-traits-in-environmental-space">Mapping traits in environmental space<a class="anchor" aria-label="anchor" href="#mapping-traits-in-environmental-space"></a>
</h2>
<p>The function <code>lets.maplizer.env</code> also allow users to map
species attributes in both environmental and geographic spaces. Let’s
use the species description date available in the <code>IUCN</code>
example object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"IUCN"</span><span class="op">)</span></span>
<span><span class="co"># Map mean description year</span></span>
<span><span class="va">res_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.maplizer.env.html">lets.maplizer.env</a></span><span class="op">(</span><span class="va">res</span>, </span>
<span>                             y <span class="op">=</span> <span class="va">IUCN</span><span class="op">$</span><span class="va">Description_Year</span>, </span>
<span>                             z <span class="op">=</span> <span class="va">IUCN</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></code></pre></div>
<p>The results are pretty similar to the <code>lets.envpam</code>
results, except that now instead of presence-absence for each species
there will be the summarized attribute. In this case the mean
description year per cell. You can also use the
<code>lets.plot.envpam</code> function to visualize the results (notice
that you cannot plot individual species or cells in this case).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plotting trait maps</span></span>
<span><span class="fu"><a href="../reference/lets.plot.envpam.html">lets.plot.envpam</a></span><span class="op">(</span><span class="va">res_map</span><span class="op">)</span></span></code></pre></div>
<p><img src="Mapping-species-richness-in-environmental-space_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="" width="768" style="display: block; margin: auto;"></p>
<p>In sum, the <code><a href="../reference/lets.envpam.html">lets.envpam()</a></code> function offers a simple yet
powerful way to explore biodiversity patterns in environmental space. It
enables users to:<br>
- Bin species distributions along ecological gradients.<br>
- Compare spatial and environmental richness.<br>
- Perform niche-based or trait-environment studies.</p>
<p>For advanced analyses, the resulting matrices and rasters can be used
in statistical models or overlaid with environmental constraints.</p>
</div>
<div class="section level2">
<h2 id="describing-environmentalgeographical-structure">Describing environmental–geographical structure<a class="anchor" aria-label="anchor" href="#describing-environmentalgeographical-structure"></a>
</h2>
<p>The object <code>res</code> links geographic and environmental
spaces. We can quantify that structure using
<code><a href="../reference/lets.envcells.html">lets.envcells()</a></code>, which returns per–environmental-cell
descriptors such as frequency (how many geographic cells map to the same
environmental bin), geographic isolation among those cells, distances to
environmental midpoints (negated so larger values imply higher
“centrality”), and distances to environmental borders.</p>
</div>
<div class="section level2">
<h2 id="summarize-descriptors-per-environmental-cell">Summarize descriptors per environmental cell<a class="anchor" aria-label="anchor" href="#summarize-descriptors-per-environmental-cell"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.envcells.html">lets.envcells</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>  <span class="co"># perc controls the robust border metric</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Cell_env Frequency Isolation (Min.) Isolation (1st Qu.) Isolation (Median)</span></span>
<span><span class="co">#&gt; 3        1         0               NA                  NA                 NA</span></span>
<span><span class="co">#&gt; 4        2         0               NA                  NA                 NA</span></span>
<span><span class="co">#&gt; 5        3         0               NA                  NA                 NA</span></span>
<span><span class="co">#&gt; 6        4         0               NA                  NA                 NA</span></span>
<span><span class="co">#&gt; 7        5         0               NA                  NA                 NA</span></span>
<span><span class="co">#&gt; 8        6         0               NA                  NA                 NA</span></span>
<span><span class="co">#&gt;   Isolation (Mean) Isolation (3rd Qu.) Isolation (Max.)</span></span>
<span><span class="co">#&gt; 3               NA                  NA               NA</span></span>
<span><span class="co">#&gt; 4               NA                  NA               NA</span></span>
<span><span class="co">#&gt; 5               NA                  NA               NA</span></span>
<span><span class="co">#&gt; 6               NA                  NA               NA</span></span>
<span><span class="co">#&gt; 7               NA                  NA               NA</span></span>
<span><span class="co">#&gt; 8               NA                  NA               NA</span></span>
<span><span class="co">#&gt;   Weighted Mean Distance to midpoint Mean Distance to midpoint</span></span>
<span><span class="co">#&gt; 3                          -3.730908                 -3.457246</span></span>
<span><span class="co">#&gt; 4                          -3.646836                 -3.382386</span></span>
<span><span class="co">#&gt; 5                          -3.564523                 -3.309862</span></span>
<span><span class="co">#&gt; 6                          -3.484092                 -3.239832</span></span>
<span><span class="co">#&gt; 7                          -3.405677                 -3.172460</span></span>
<span><span class="co">#&gt; 8                          -3.329421                 -3.107918</span></span>
<span><span class="co">#&gt;   Minimum Zero Distance Minimum 10% Zero Distance Distance to MCP border</span></span>
<span><span class="co">#&gt; 3                     0                 0.9362266                      0</span></span>
<span><span class="co">#&gt; 4                     0                 0.8700119                      0</span></span>
<span><span class="co">#&gt; 5                     0                 0.8136812                      0</span></span>
<span><span class="co">#&gt; 6                     0                 0.7676179                      0</span></span>
<span><span class="co">#&gt; 7                     0                 0.7323872                      0</span></span>
<span><span class="co">#&gt; 8                     0                 0.7068043                      0</span></span>
<span><span class="co">#&gt;   Frequency Weighted Distance</span></span>
<span><span class="co">#&gt; 3                    3.800462</span></span>
<span><span class="co">#&gt; 4                    3.718461</span></span>
<span><span class="co">#&gt; 5                    3.638213</span></span>
<span><span class="co">#&gt; 6                    3.559825</span></span>
<span><span class="co">#&gt; 7                    3.483411</span></span>
<span><span class="co">#&gt; 8                    3.409092</span></span></code></pre></div>
<p>Key columns are:</p>
<p>Frequency: geographic aggregation into the same environmental
cell.</p>
<p>Isolation: summary of pairwise geographic distances among geographic
cells mapped to that environmental bin.</p>
<p>Weighted Mean Distance to midpoint and Mean Distance to midpoint:
negated distances in standardized environmental space (larger = more
central).</p>
<p>Minimum Zero Distance, Minimum 10% Zero Distance (here 20% because
perc = 0.2), and Distance to MCP border: three proxies for environmental
“edge”.</p>
<p>Mapping descriptor layers</p>
<p>We can plot every descriptor over the environmental raster grid.
Optionally, set ras = TRUE to also retrieve the layers as a named list
of SpatRaster objects for further use.</p>
<div class="section level3">
<h3 id="plot-the-descriptors">Plot the descriptors<a class="anchor" aria-label="anchor" href="#plot-the-descriptors"></a>
</h3>
<p>Plot all descriptors (environmental grid)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lets.plot.envcells.html">lets.plot.envcells</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><img src="Mapping-species-richness-in-environmental-space_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" alt="" width="768" style="display: block; margin: auto;"></p>
<p>Optionally retrieve rasters for further analysis:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ras_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lets.plot.envcells.html">lets.plot.envcells</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">out</span>, ras <span class="op">=</span> <span class="cn">TRUE</span>, plot_ras <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="diagnosing-centrality-vs--richness-optional">Diagnosing centrality vs. richness (optional)<a class="anchor" aria-label="anchor" href="#diagnosing-centrality-vs--richness-optional"></a>
</h2>
<p>As a simple diagnostic, we may examine whether environmental
centrality (negated distance to the weighted midpoint) co-varies with
environmental richness.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centrality</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[[</span><span class="st">"Weighted Mean Distance to midpoint"</span><span class="op">]</span><span class="op">]</span>   <span class="co"># larger = more central</span></span>
<span><span class="va">rich_env</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">Presence_and_Absence_Matrix_env</span><span class="op">[</span>, <span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mantain cells without zero</span></span>
<span><span class="va">keep</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">Presence_and_Absence_Matrix_env</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">centrality</span> <span class="op">&lt;-</span> <span class="va">centrality</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot relationship</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">centrality</span>, <span class="va">rich_env</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Centrality (negated distance to weighted midpoint)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Species richness"</span>,</span>
<span>     pch  <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">rich_env</span> <span class="op">~</span> <span class="va">centrality</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Mapping-species-richness-in-environmental-space_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" alt="" width="768" style="display: block; margin: auto;"></p>
<p>These descriptors often reveal whether species accumulate in central
portions of environmental space or cluster near edges (where
zero-richness neighbors are close), thereby sharpening inference about
ecological filtering and range limits.</p>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<ul>
<li>Vilela, B. &amp; Villalobos, F. (2015). letsR: a new R package for
data handling and analysis in macroecology. <em>Methods in Ecology and
Evolution</em>, 6(10), 1229–1234.</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bruno Vilela, Fabricio Villalobos.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
